{% extends 'layout.html' %}

{% block title %}
  Desempenho do Aluno (Admin)
{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="text-center mb-5">
    <i class="bi bi-bar-chart-fill text-primary" style="font-size: 3rem;"></i>
    <h2 class="fw-bold mt-3">Desempenho do Aluno</h2>
    <p class="text-muted mb-0">Visualização completa das tarefas, notas e médias por professor</p>
  </div>

  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <h4 class="fw-semibold text-primary mb-3">{{ student.name }}</h4>

      <p class="mb-1"><strong>Email:</strong> {{ student.email }}</p>
      <p class="mb-1"><strong>Nascimento:</strong> {{ student.born_date.strftime('%d/%m/%Y') }}</p>
      <p class="mb-1"><strong>Turma:</strong> {{ student.classroom.name }}</p>
    </div>
  </div>

  {% for teacher, assignments in assignments_by_teacher.items() %}
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">

      <h5 class="fw-semibold text-secondary mb-3">
        <i class="bi bi-person-workspace me-2"></i>
        Tarefas do Professor {{ teacher.name }}

        {% if teacher_avgs[teacher] is not none %}
          <span class="ms-3 text-success fw-bold">Média: {{ "%.1f"|format(teacher_avgs[teacher]) }}/10</span>
        {% else %}
          <span class="ms-3 text-muted">(Sem notas)</span>
        {% endif %}
      </h5>

      <table class="table table-hover table-bordered align-middle bg-white mb-0">
        <thead class="table-primary text-center">
          <tr>
            <th>ID</th>
            <th>Tarefa</th>
            <th>Entrega</th>
            <th>Arquivo</th>
            <th>Valor</th>
            <th>Nota</th>
          </tr>
        </thead>
        <tbody>
          {% for sa in assignments %}
          <tr>
            <td class="text-center">{{ sa.assignment.id }}</td>
            <td>{{ sa.assignment.name }}</td>
            <td class="text-center">
              {{ sa.assignment.due_date.strftime('%d/%m/%Y') }}
            </td>
            <td class="text-center">
              {% if sa.assignment.file %}
                <a href="{{ url_for('teacher_bp.download_file', filename=sa.assignment.file) }}" class="text-primary">
                  <i class="bi bi-file-earmark-arrow-down"></i>
                </a>
              {% else %}
                —
              {% endif %}
            </td>
            <td class="text-center">{{ sa.assignment.grade_worth }}</td>
            <td class="text-center">
              {% if sa.grade is not none %}
                <span class="fw-bold text-success">{{ sa.grade }}</span>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

    </div>
  </div>
  {% endfor %}

  <div class="d-flex justify-content-start mt-4">
    <a href="{{ url_for('admin_bp.manage_students') }}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left me-1"></i> Voltar
    </a>
  </div>

</div>
{% endblock %}